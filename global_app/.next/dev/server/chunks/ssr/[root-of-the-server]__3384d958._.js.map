{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefanolaptop/Documents/Codex/global_app/app/dashboard/capogruppo/page.tsx"],"sourcesContent":["import { cookies } from \"next/headers\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst SUPABASE_URL = process.env.SUPABASE_URL;\nconst SUPABASE_ANON_KEY = process.env.SUPABASE_ANON_KEY;\n\nif (!SUPABASE_URL || !SUPABASE_ANON_KEY) {\n  throw new Error(\n    \"Missing SUPABASE_URL or SUPABASE_ANON_KEY environment variables.\"\n  );\n}\n\nasync function getAccessTokenFromCookies() {\n  const store = await cookies();\n  const direct = store.get(\"sb-access-token\")?.value;\n  if (direct) return direct;\n\n  const authCookie = store\n    .getAll()\n    .find(\n      (c) => c.name.startsWith(\"sb-\") && c.name.endsWith(\"-auth-token\")\n    );\n\n  if (!authCookie) return null;\n\n  try {\n    const parsed = JSON.parse(authCookie.value);\n    return parsed?.access_token ?? null;\n  } catch {\n    return null;\n  }\n}\n\nexport default async function CapogruppoPage() {\n  const accessToken = await getAccessTokenFromCookies();\n\n  if (!accessToken) {\n    return (\n      <main className=\"mx-auto max-w-5xl px-6 py-10\">\n        <h1 className=\"text-2xl font-semibold\">Dashboard Capogruppo</h1>\n        <p className=\"mt-4 text-sm text-neutral-600\">\n          Devi effettuare il login per vedere i partecipanti del tuo gruppo.\n        </p>\n      </main>\n    );\n  }\n\n  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {\n    auth: { persistSession: false },\n    global: { headers: { Authorization: `Bearer ${accessToken}` } },\n  });\n\n  const { data, error } = await supabase\n    .from(\"partecipanti\")\n    .select(\n      \"id,nome,cognome,email,gruppo_id,giorni_permanenza,quota_totale,albergo_id,stanza_id\"\n    )\n    .order(\"cognome\", { ascending: true });\n\n  return (\n    <main className=\"mx-auto max-w-5xl px-6 py-10\">\n      <h1 className=\"text-2xl font-semibold\">Dashboard Capogruppo</h1>\n      <p className=\"mt-2 text-sm text-neutral-600\">\n        Partecipanti del tuo gruppo\n      </p>\n\n      {error ? (\n        <div className=\"mt-6 rounded border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700\">\n          Errore nel caricamento: {error.message}\n        </div>\n      ) : (\n        <div className=\"mt-6 overflow-x-auto rounded border border-neutral-200\">\n          <table className=\"w-full border-collapse text-left text-sm\">\n            <thead className=\"bg-neutral-50 text-neutral-700\">\n              <tr>\n                <th className=\"px-4 py-3\">Nome</th>\n                <th className=\"px-4 py-3\">Cognome</th>\n                <th className=\"px-4 py-3\">Email</th>\n                <th className=\"px-4 py-3\">Gruppo</th>\n                <th className=\"px-4 py-3\">Giorni</th>\n                <th className=\"px-4 py-3\">Quota</th>\n              </tr>\n            </thead>\n            <tbody>\n              {(data ?? []).map((p) => (\n                <tr key={p.id} className=\"border-t border-neutral-100\">\n                  <td className=\"px-4 py-3\">{p.nome}</td>\n                  <td className=\"px-4 py-3\">{p.cognome}</td>\n                  <td className=\"px-4 py-3\">{p.email}</td>\n                  <td className=\"px-4 py-3\">{p.gruppo_id ?? \"-\"}</td>\n                  <td className=\"px-4 py-3\">{p.giorni_permanenza}</td>\n                  <td className=\"px-4 py-3\">â‚¬ {p.quota_totale}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,YAAY;AAC7C,MAAM,oBAAoB,QAAQ,GAAG,CAAC,iBAAiB;AAEvD,IAAI,CAAC,gBAAgB,CAAC,mBAAmB;IACvC,MAAM,IAAI,MACR;AAEJ;AAEA,eAAe;IACb,MAAM,QAAQ,MAAM,IAAA,0IAAO;IAC3B,MAAM,SAAS,MAAM,GAAG,CAAC,oBAAoB;IAC7C,IAAI,QAAQ,OAAO;IAEnB,MAAM,aAAa,MAChB,MAAM,GACN,IAAI,CACH,CAAC,IAAM,EAAE,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC;IAGvD,IAAI,CAAC,YAAY,OAAO;IAExB,IAAI;QACF,MAAM,SAAS,KAAK,KAAK,CAAC,WAAW,KAAK;QAC1C,OAAO,QAAQ,gBAAgB;IACjC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEe,eAAe;IAC5B,MAAM,cAAc,MAAM;IAE1B,IAAI,CAAC,aAAa;QAChB,qBACE,8OAAC;YAAK,WAAU;;8BACd,8OAAC;oBAAG,WAAU;8BAAyB;;;;;;8BACvC,8OAAC;oBAAE,WAAU;8BAAgC;;;;;;;;;;;;IAKnD;IAEA,MAAM,WAAW,IAAA,8LAAY,EAAC,cAAc,mBAAmB;QAC7D,MAAM;YAAE,gBAAgB;QAAM;QAC9B,QAAQ;YAAE,SAAS;gBAAE,eAAe,CAAC,OAAO,EAAE,aAAa;YAAC;QAAE;IAChE;IAEA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,gBACL,MAAM,CACL,uFAED,KAAK,CAAC,WAAW;QAAE,WAAW;IAAK;IAEtC,qBACE,8OAAC;QAAK,WAAU;;0BACd,8OAAC;gBAAG,WAAU;0BAAyB;;;;;;0BACvC,8OAAC;gBAAE,WAAU;0BAAgC;;;;;;YAI5C,sBACC,8OAAC;gBAAI,WAAU;;oBAA8E;oBAClE,MAAM,OAAO;;;;;;qCAGxC,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAM,WAAU;;sCACf,8OAAC;4BAAM,WAAU;sCACf,cAAA,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAY;;;;;;kDAC1B,8OAAC;wCAAG,WAAU;kDAAY;;;;;;kDAC1B,8OAAC;wCAAG,WAAU;kDAAY;;;;;;kDAC1B,8OAAC;wCAAG,WAAU;kDAAY;;;;;;kDAC1B,8OAAC;wCAAG,WAAU;kDAAY;;;;;;kDAC1B,8OAAC;wCAAG,WAAU;kDAAY;;;;;;;;;;;;;;;;;sCAG9B,8OAAC;sCACE,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC,kBACjB,8OAAC;oCAAc,WAAU;;sDACvB,8OAAC;4CAAG,WAAU;sDAAa,EAAE,IAAI;;;;;;sDACjC,8OAAC;4CAAG,WAAU;sDAAa,EAAE,OAAO;;;;;;sDACpC,8OAAC;4CAAG,WAAU;sDAAa,EAAE,KAAK;;;;;;sDAClC,8OAAC;4CAAG,WAAU;sDAAa,EAAE,SAAS,IAAI;;;;;;sDAC1C,8OAAC;4CAAG,WAAU;sDAAa,EAAE,iBAAiB;;;;;;sDAC9C,8OAAC;4CAAG,WAAU;;gDAAY;gDAAG,EAAE,YAAY;;;;;;;;mCANpC,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;AAe7B"}}]
}